# GitHub Copilot — Project Instructions

## Project Context

This is a **SQL Server performance tuning and SSIS optimization demo** repository. It contains intentionally suboptimal SQL artifacts (stored procedures, views, queries, SSIS scripts) designed to showcase GitHub Copilot's ability to identify performance issues and suggest optimizations.

### Database Platform

- **Target**: Microsoft SQL Server 2019 / 2022
- **Database**: `ECommerceDemo` — a fictional e-commerce system
- **Schema**: Star-schema-influenced design with `Customers`, `Orders`, `OrderItems`, `Products`, `Categories`, `Inventory`, and `SalesHistory` tables

### Schema Quick Reference

```
Customers (id, first_name, last_name, email, phone, address, city, state, zip_code, country, created_at, updated_at)
Categories (id, name, description, parent_category_id, created_at, updated_at)
Products (id, name, description, category_id → Categories, price, cost, sku, is_active, created_at, updated_at)
Inventory (id, product_id → Products, warehouse_location, quantity_on_hand, reorder_level, last_restocked_at, created_at, updated_at)
Orders (id, customer_id → Customers, order_date, status, total_amount, shipping_address, shipping_city, shipping_state, shipping_zip, payment_method, created_at, updated_at)
OrderItems (id, order_id → Orders, product_id → Products, quantity, unit_price, discount_percent, line_total, created_at, updated_at)
SalesHistory (id, product_id → Products, customer_id → Customers, order_id → Orders, sale_date, quantity, revenue, cost, profit, region, created_at)
```

## T-SQL Conventions

When generating or optimizing SQL code in this project, follow these conventions:

### Naming
- **Stored Procedures**: Prefix with `usp_`, use PascalCase (e.g., `usp_GetCustomerOrders`)
- **Views**: Prefix with `vw_`, use PascalCase (e.g., `vw_CustomerOrderSummary`)
- **Functions**: Prefix with `fn_`, use PascalCase (e.g., `fn_CalculateDiscount`)
- **Indexes**: `IX_TableName_Column1_Column2`
- **Primary Keys**: `PK_TableName`
- **Foreign Keys**: `FK_ChildTable_ParentTable`
- **Parameters**: Prefix with `@`, use camelCase (e.g., `@customerId`)

### SQL Style
- Use UPPERCASE for SQL keywords (`SELECT`, `FROM`, `WHERE`, `JOIN`)
- Use consistent indentation (4 spaces)
- One clause per line for readability
- Qualify columns with table aliases when joining multiple tables
- Always use explicit `JOIN` syntax, never implicit comma joins

### Performance-First Mindset
- Always consider index usage when writing or reviewing queries
- Prefer set-based operations over cursors and loops
- Include `SET NOCOUNT ON` in all stored procedures
- Use `TRY...CATCH` blocks for error handling
- Avoid `SELECT *` — always list explicit columns
- Ensure WHERE clause predicates are SARGable
- Consider query parameter sniffing and use `OPTION (RECOMPILE)` where appropriate

### When Optimizing SQL Code
1. **Explain the problem** — Describe what anti-pattern or performance issue exists
2. **Show the impact** — Estimate the performance difference (table scans vs seeks, etc.)
3. **Provide the fix** — Show the optimized code with clear comments
4. **Recommend indexes** — Suggest supporting indexes if applicable
5. **Add monitoring** — Include execution statistics or `SET STATISTICS IO ON` examples

### SSIS Package Conventions
- Use descriptive task names in Data Flow components
- Prefer bulk insert over row-by-row processing
- Cache lookup reference data when possible (Full Cache mode)
- Use OLE DB Destination with "Fast Load" option
- Implement proper error handling with event handlers
- Log package execution metrics

## File Organization

- `samples/stored-procedures/before/` — Contains intentionally suboptimal SPs for demo
- `samples/stored-procedures/after/` — Optimized SPs generated by `@sql-performance-tuner` or `@sql-code-reviewer` agents
- `samples/views/before/` — Contains intentionally suboptimal views for demo
- `samples/views/after/` — Optimized views generated by `@sql-performance-tuner` or `@sql-code-reviewer` agents
- `samples/queries/before/` — Contains intentionally slow queries for analysis
- `samples/queries/after/` — Optimized queries generated by `@sql-performance-tuner` or `@sql-code-reviewer` agents
- `samples/queries/assessment/` — Assessment reports generated by `/analyze-slow-query`, `/assess-stored-procedure`, `/assess-view`, `/assess-ssis-package`, `/generate-index-recommendations`, and `/review-execution-plan` prompts
- `samples/ssis/before/` — Contains suboptimal SSIS ETL scripts for demo
- `samples/ssis/after/` — Optimized ETL scripts generated by `@ssis-optimizer` agent
- `samples/database-setup/` — Schema creation and seed data scripts
